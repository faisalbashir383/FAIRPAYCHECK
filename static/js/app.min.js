(()=>{let l="/api/calculate/",c=5e3,t=window.COUNTRY_CURRENCIES||{USA:{symbol:"$",code:"USD"},UK:{symbol:"£",code:"GBP"},Germany:{symbol:"€",code:"EUR"},Canada:{symbol:"C$",code:"CAD"},Australia:{symbol:"A$",code:"AUD"},India:{symbol:"₹",code:"INR"}},n=window.ROLE_SKILL_SUGGESTIONS||{},a=window.ROLE_KEYWORDS||{},u={likely_underpaid:"underpaid",possibly_underpaid:"possibly-underpaid",fairly_paid:"fairly-paid",fairly_overpaid:"fairly-paid"},d={likely_underpaid:"#E53E3E",possibly_underpaid:"#D69E2E",fairly_paid:"#38A169",fairly_overpaid:"#38A169"},r=["Software Engineer","Senior Software Engineer","Staff Software Engineer","Principal Engineer","Frontend Developer","Backend Developer","Full Stack Developer","DevOps Engineer","Site Reliability Engineer","Cloud Engineer","Platform Engineer","Data Engineer","Data Scientist","Data Analyst","Machine Learning Engineer","AI Engineer","Product Manager","Senior Product Manager","Product Owner","Program Manager","Project Manager","Scrum Master","UX Designer","UI Designer","Product Designer","Graphic Designer","Motion Designer","Marketing Manager","Digital Marketing Manager","Growth Manager","Content Manager","SEO Specialist","Sales Manager","Account Executive","Business Development Manager","Account Manager","Customer Success Manager","Financial Analyst","Senior Accountant","Controller","FP&A Manager","HR Manager","Recruiter","Talent Acquisition Manager","People Operations Manager","Operations Manager","Supply Chain Manager","Business Analyst","Solutions Architect","Technical Lead","Engineering Manager","CTO","VP of Engineering","Director of Engineering","Head of Product","Head of Design"],m={track(e,t={}){console.debug("Analytics:",e,t)}},g={form:document.getElementById("fairpay-form"),formSection:document.querySelector(".form-section"),resultsSection:document.getElementById("results"),loadingOverlay:document.getElementById("loading"),loadingText:document.getElementById("loading-text"),heroSection:document.getElementById("hero"),howItWorks:document.getElementById("how-it-works"),progressSteps:document.querySelectorAll(".progress-step"),formSteps:document.querySelectorAll(".form-step"),nextButtons:document.querySelectorAll(".btn-next"),backButtons:document.querySelectorAll(".btn-back"),submitButton:document.querySelector(".btn-submit"),startOverButton:document.getElementById("btn-start-over"),experienceSlider:document.getElementById("years_experience"),experienceDisplay:document.getElementById("experience-display"),countrySelect:document.getElementById("country"),currencySymbol:document.getElementById("currency-symbol"),bonusPrefix:document.querySelector(".bonus-prefix"),jobTitleInput:document.getElementById("job_title"),jobSuggestions:document.getElementById("job-suggestions"),skillsInput:document.getElementById("skills"),skillSuggestions:document.getElementById("skill-suggestions"),skillChips:document.getElementById("skill-chips"),themeToggle:document.getElementById("theme-toggle"),resultScore:document.getElementById("result-score"),resultVerdict:document.getElementById("result-verdict"),resultConfidence:document.getElementById("result-confidence"),resultSalaryMin:document.getElementById("result-salary-min"),resultSalaryMax:document.getElementById("result-salary-max"),resultReasons:document.getElementById("result-reasons"),resultDataUpdated:document.getElementById("result-data-updated"),resultDisclaimer:document.getElementById("result-disclaimer"),scoreRingProgress:document.querySelector(".score-ring-progress")},o=1,p={},s=-1,i="default";function y(e){e&&e.classList.remove("hidden")}function f(e){e&&e.classList.add("hidden")}function v(e){e&&e.scrollIntoView({behavior:"smooth",block:"start"})}function S(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}function e(){var e="dark"===document.documentElement.getAttribute("data-theme")?"light":"dark";document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e),m.track("theme_toggle",{theme:e})}function E(e){if(e){var t,n,r=e.toLowerCase();for([t,n]of Object.entries(a))for(var o of n)if(r.includes(o.toLowerCase()))return t}return"default"}function h(e){if(g.skillChips&&g.skillSuggestions){e=n[e]||n.default||[];if(0===e.length)f(g.skillSuggestions);else{let t=(g.skillsInput.value||"").split(",").map(e=>e.trim().toLowerCase()).filter(e=>e);g.skillChips.innerHTML=e.slice(0,12).map(e=>`<span class="skill-chip${t.includes(e.toLowerCase())?" selected":""}" data-skill="${S(e)}">${S(e)}</span>`).join(""),y(g.skillSuggestions)}}}function k(e){e=document.querySelector(`.form-step[data-step="${e}"]`).querySelectorAll("[required]");let n=!0;return e.forEach(t=>{t.value&&""!==t.value.trim()?t.classList.remove("error"):(n=!1,t.classList.add("error"),t.addEventListener("input",function e(){t.classList.remove("error"),t.removeEventListener("input",e)},{once:!0}))}),n}function b(n){n<1||3<n||n>o&&!k(o)||(g.formSteps.forEach(e=>{e.classList.remove("active"),parseInt(e.dataset.step)===n&&e.classList.add("active")}),g.progressSteps.forEach(e=>{var t=parseInt(e.dataset.step);e.classList.remove("active","completed"),t===n?e.classList.add("active"):t<n&&e.classList.add("completed")}),2===(o=n)&&g.jobTitleInput&&h(i=E(g.jobTitleInput.value)),1<n&&m.track("form_step_"+n),v(g.formSection))}function I(){var e=g.countrySelect.value,e=t[e]||t.USA;g.currencySymbol&&(g.currencySymbol.textContent=e.symbol),g.bonusPrefix&&(g.bonusPrefix.textContent=e.symbol)}function L(){g.experienceSlider&&g.experienceDisplay&&(g.experienceDisplay.textContent=g.experienceSlider.value)}let C=["Analyzing market data...","Comparing salary benchmarks...","Evaluating skill premiums...","Calculating experience factors...","Finalizing your assessment..."],w=null;function x(){w&&(clearInterval(w),w=null)}async function A(){p=(()=>{var t={},n=g.form.elements;for(let e=0;e<n.length;e++){var r=n[e];r.name&&""!==r.name&&("radio"===r.type?r.checked&&(t[r.name]="true"===r.value||"false"!==r.value&&r.value):"number"===r.type?t[r.name]=r.value?parseFloat(r.value):null:t[r.name]=r.value)}return t})(),y(g.loadingOverlay);{let e=0;g.loadingText&&(g.loadingText.textContent=C[0],w=setInterval(()=>{e=(e+1)%C.length,g.loadingText.textContent=C[e]},1e3));var t=document.querySelector(".loading-bar");t&&(t.style.animation="none",t.offsetHeight,t.style.animation="loadingProgress 5s ease-out forwards")}m.track("form_submit",{country:p.country,has_salary:!!p.salary});try{var e=fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),n=new Promise(e=>setTimeout(e,c)),[r]=await Promise.all([e,n]),o=await r.json();if(!r.ok)throw new Error(o.error||"An error occurred");x(),f(g.loadingOverlay);var a=o;f(g.formSection),f(g.heroSection),g.howItWorks&&f(g.howItWorks),y(g.resultsSection);{var s=a.score,i=a.verdict_code;let o=performance.now(),e=d[i]||d.fairly_paid;g.scoreRingProgress.style.stroke=e,requestAnimationFrame(function e(t){var t=t-o,t=Math.min(t/1e3,1),n=1-Math.pow(1-t,3),r=Math.round(n*s),r=(g.resultScore.textContent=r,339.292-n*s/100*339.292);g.scoreRingProgress.style.strokeDashoffset=r,t<1&&requestAnimationFrame(e)})}g.resultVerdict.textContent=a.verdict,g.resultVerdict.className="verdict "+u[a.verdict_code],g.resultConfidence.textContent="Confidence: "+a.confidence,g.resultSalaryMin.textContent=a.salary_range.formatted_min,g.resultSalaryMax.textContent=a.salary_range.formatted_max,g.resultReasons.innerHTML=a.reasons.map(e=>`<li>${S(e)}</li>`).join(""),g.resultDataUpdated.textContent="Market data last updated: "+a.data_updated,g.resultDisclaimer.textContent=a.disclaimer,v(g.resultsSection),m.track("result_viewed",{score:a.score,verdict:a.verdict_code,confidence:a.confidence})}catch(e){x(),f(g.loadingOverlay),console.error("API Error:",e),alert("Sorry, there was an error processing your request. Please try again.")}}function M(){g.form.reset(),o=1,p={},i="default",b(1),f(g.resultsSection),y(g.heroSection),g.howItWorks&&y(g.howItWorks),y(g.formSection),f(g.skillSuggestions),L(),I(),g.scoreRingProgress.style.strokeDashoffset=339.292,g.resultScore.textContent="0",v(g.heroSection)}function D(e){g.jobSuggestions&&(0===e.length?B():(g.jobSuggestions.innerHTML=e.map((e,t)=>{return`<div class="suggestion-item${t===s?" selected":""}" data-index="${t}">${t=e,e=g.jobTitleInput.value,n=t.toLowerCase().indexOf(e.toLowerCase()),-1===n?t:t.substring(0,n)+"<strong>"+t.substring(n,n+e.length)+"</strong>"+t.substring(n+e.length)}</div>`;var n}).join(""),y(g.jobSuggestions)))}function B(){g.jobSuggestions&&(f(g.jobSuggestions),s=-1)}function j(e){g.jobTitleInput.value=e,B(),i=E(e)}function T(e){e.forEach((e,t)=>{e.classList.toggle("selected",t===s)}),0<=s&&e[s]&&e[s].scrollIntoView({block:"nearest"})}function _(){g.jobTitleInput&&(g.jobTitleInput.addEventListener("input",()=>{var e=(e=>{if(!e||e.length<2)return[];let t=e.toLowerCase();return r.filter(e=>e.toLowerCase().includes(t)).slice(0,8)})(g.jobTitleInput.value);s=-1,D(e)}),g.jobTitleInput.addEventListener("keydown",e=>{var t;g.jobSuggestions&&!g.jobSuggestions.classList.contains("hidden")&&(t=g.jobSuggestions.querySelectorAll(".suggestion-item"),"ArrowDown"===e.key?(e.preventDefault(),s=Math.min(s+1,t.length-1),T(t)):"ArrowUp"===e.key?(e.preventDefault(),s=Math.max(s-1,0),T(t)):"Enter"===e.key&&0<=s?(e.preventDefault(),j(t[s].textContent)):"Escape"===e.key&&B())}),g.jobTitleInput.addEventListener("blur",()=>{setTimeout(B,200)}),g.jobSuggestions)&&g.jobSuggestions.addEventListener("click",e=>{e=e.target.closest(".suggestion-item");e&&j(e.textContent)})}function O(){g.nextButtons.forEach(e=>{e.addEventListener("click",()=>b(parseInt(e.dataset.next)))}),g.backButtons.forEach(e=>{e.addEventListener("click",()=>b(parseInt(e.dataset.back)))}),g.form.addEventListener("submit",e=>{e.preventDefault(),k(3)&&A()}),g.startOverButton&&g.startOverButton.addEventListener("click",M),g.experienceSlider&&g.experienceSlider.addEventListener("input",L),g.countrySelect&&g.countrySelect.addEventListener("change",I),g.themeToggle&&g.themeToggle.addEventListener("click",e),g.skillChips&&g.skillChips.addEventListener("click",e=>{var t,n,e=e.target.closest(".skill-chip");e&&(t=e.dataset.skill,g.skillsInput)&&((n=(e=g.skillsInput.value.trim()).split(",").map(e=>e.trim()).filter(e=>e)).some(e=>e.toLowerCase()===t.toLowerCase())?(n=n.filter(e=>e.toLowerCase()!==t.toLowerCase()),g.skillsInput.value=n.join(", ")):g.skillsInput.value=e?e+", "+t:t,h(i))});let t=g.form.querySelector("input, select");t&&t.addEventListener("focus",function e(){m.track("form_start"),t.removeEventListener("focus",e)},{once:!0})}function P(){var e,t;e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches,e?document.documentElement.setAttribute("data-theme",e):t&&document.documentElement.setAttribute("data-theme","dark"),O(),document.addEventListener("keydown",e=>{g.formSection.classList.contains("hidden")||"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&"job_title"!==e.target.id&&3!==o&&(e.preventDefault(),b(o+1))}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){var t=this.getAttribute("href");"#"!==t&&(t=document.querySelector(t))&&(e.preventDefault(),v(t))})});{let e=document.querySelectorAll(".faq-item");e.forEach(t=>{t.addEventListener("toggle",()=>{t.open&&e.forEach(e=>{e!==t&&e.open&&(e.open=!1)})})})}_(),L(),I(),m.track("page_load"),console.log("FairPayCheck initialized")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",P):P()})();